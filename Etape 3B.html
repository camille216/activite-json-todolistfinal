<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Étape 3B — Enregistrement d’une tâche</title>
</head>
<body>
  <h1>Ajouter une tâche</h1>

  <form id="form-tache" novalidate>
    <label>Titre :
      <input type="text" id="libelle" required>
    </label><br><br>

    <label>Description :
      <textarea id="description" required></textarea>
    </label><br><br>

    <label>Date de création :
      <input type="date" id="dateCreation" required>
    </label><br><br>

    <label>Date de fin :
      <input type="date" id="dateFin">
    </label><br><br>

    <label>Priorité :
      <select id="priorite" required>
        <option value="">-- Choisir --</option>
        <option value="1">Très important</option>
        <option value="2">Important</option>
        <option value="3">Moyen</option>
        <option value="4">Peu important</option>
        <option value="5">Non prioritaire</option>
      </select>
    </label><br><br>

    <label>État :
      <select id="etat" required>
        <option value="">-- Choisir --</option>
        <option value="1">À faire</option>
        <option value="2">En cours</option>
        <option value="3">En attente</option>
        <option value="4">Terminé</option>
      </select>
    </label><br><br>

    <label>Contexte :
      <select id="contexte" required>
        <option value="">-- Choisir --</option>
        <option value="1">Travail</option>
        <option value="2">Maison</option>
        <option value="3">Courses</option>
        <option value="4">Loisirs</option>
      </select>
    </label><br><br>

    <button type="button" onclick="saveTask()">Enregistrer la tâche</button>
  </form>

  <script>
    function saveTask() {
      const form = document.getElementById("form-tache");

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      const libelle = document.getElementById("libelle").value.trim();
      const description = document.getElementById("description").value.trim();
      const dateCreation = document.getElementById("dateCreation").value;
      const dateFin = document.getElementById("dateFin").value;
      const idPriorite = document.getElementById("priorite").value;
      const idEtat = document.getElementById("etat").value;
      const idContexte = document.getElementById("contexte").value;

      let taches = JSON.parse(localStorage.getItem("taches")) || [];

      let newId = 1;
      if (taches.length > 0) {
        newId = Math.max(...taches.map(t => Number(t.idTache))) + 1;
      }

      const nouvelleTache = {
        idTache: newId.toString(),
        libelle,
        description,
        dateCreation,
        dateFin: dateFin || null,
        idPriorite,
        idEtat,
        idContexte
      };

      console.log("Nouvelle tâche :", nouvelleTache);

      taches.push(nouvelleTache);
      localStorage.setItem("taches", JSON.stringify(taches));

      form.reset();
      alert("Tâche enregistrée avec succès !");
    }
  </script>
</body>
</html>
