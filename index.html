<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8">
  <title>Ma To-Do List - Formulaire Complet</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    /* STYLE ISSU DE L'√âTAPE 2B */
    :root {
      --bg: #ffffff;
      --text: #0f172a;
      --muted: #475569;
      --primary: #0ea5e9;
      --ring: #38bdf8;
      --ring-shadow: rgba(56, 189, 248, 0.28); 
      --border: #e2e8f0;
      --card: #f8fafc;
      --radius: 14px;
      --space: 1rem;
      --space-sm: .5rem;
      --space-lg: 1.25rem;
      --maxw: 720px;
    }

    * { box-sizing: border-box; }
    body {
      margin: 0;
      font-family: system-ui, -apple-system, sans-serif;
      line-height: 1.6;
      color: var(--text);
      background: var(--bg);
      padding: var(--space);
    }

    .container { max-width: var(--maxw); margin: 0 auto; }

    article {
      background: var(--card);
      padding: var(--space-lg);
      border-radius: var(--radius);
      border: 1px solid var(--border);
      box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    }

    h1 { font-size: 1.5rem; margin-bottom: var(--space-lg); }

    fieldset {
      border: none;
      padding: 0;
      margin-bottom: var(--space-lg);
    }

    legend { font-weight: 600; margin-bottom: var(--space); font-size: 1.1rem; }

    .grid {
      display: grid;
      gap: var(--space);
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    }

    label { display: block; font-weight: 500; margin-bottom: var(--space-sm); }
    .required::after { content: " *"; color: #ef4444; }

    input, select, textarea {
      width: 100%;
      padding: 0.6rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      font-size: 1rem;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 4px var(--ring-shadow);
    }

    .actions {
      display: flex;
      gap: var(--space);
      margin-top: var(--space-lg);
    }

    button {
      padding: 0.75rem 1.5rem;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      border: none;
    }

    button[type="submit"] {
      background: var(--primary);
      color: white;
    }

    .btn--ghost {
      background: transparent;
      border: 1px solid var(--border);
      color: var(--muted);
    }

    .hint { font-size: 0.85rem; color: var(--muted); margin-top: 4px; }
  </style>
</head>
<body>

  <main class="container">
    <article>
      <h1>üìù Nouvelle T√¢che</h1>
      
      <form id="form-tache" novalidate>
        <fieldset>
          <legend>Informations g√©n√©rales</legend>
          <div style="margin-bottom: var(--space);">
            <label for="libelle" class="required">Titre de la t√¢che</label>
            <input type="text" id="libelle" name="libelle" required placeholder="Ex: Acheter du pain">
          </div>

          <div style="margin-bottom: var(--space);">
            <label for="description">Description</label>
            <textarea id="description" name="description" rows="3"></textarea>
          </div>

          <div class="grid">
            <div>
              <label for="dateCreation" class="required">Date de cr√©ation</label>
              <input type="date" id="dateCreation" name="dateCreation" required>
            </div>
            <div>
              <label for="dateFin">Date d'√©ch√©ance</label>
              <input type="date" id="dateFin" name="dateFin">
            </div>
          </div>
        </fieldset>

        <fieldset>
          <legend>Classification</legend>
          <div class="grid">
            <div>
              <label for="priorite" class="required">Priorit√©</label>
              <select id="priorite" name="idPriorite" required></select>
            </div>

            <div>
              <label for="etat" class="required">√âtat</label>
              <select id="etat" name="idEtat" required></select>
            </div>

            <div>
              <label for="contexte" class="required">Contexte</label>
              <select id="contexte" name="idContexte" required></select>
            </div>
          </div>
        </fieldset>

        <div class="actions">
          <button type="submit">Enregistrer la t√¢che</button>
          <button type="reset" class="btn btn--ghost">R√©initialiser</button>
        </div>
      </form>
    </article>
  </main>

  <script>
    // 1. DONN√âES ISSUES DES √âTAPES 1B, 1C
    const dataApp = {
      priorites: [
        { id: "1", libelle: "Tr√®s important" },
        { id: "2", libelle: "Important" },
        { id: "3", libelle: "Moyen" },
        { id: "4", libelle: "Peu important" },
        { id: "5", libelle: "Non prioritaire" }
      ],
      etats: [
        { id: "1", libelle: "√Ä faire" },
        { id: "2", libelle: "En cours" },
        { id: "3", libelle: "En attente" },
        { id: "4", libelle: "Termin√©" }
      ],
      contextes: [
        { id: "1", libelle: "Travail" },
        { id: "2", libelle: "Maison" },
        { id: "3", libelle: "Courses" },
        { id: "4", libelle: "Loisirs" }
      ]
    };

    // 2. REMPLISSAGE DYNAMIQUE DES SELECTS (√âtape 2B)
    function fillSelect(id, data) {
      const select = document.getElementById(id);
      let options = '<option value="" selected disabled>‚Äî S√©lectionnez ‚Äî</option>';
      data.forEach(item => {
        options += `<option value="${item.id}">${item.libelle}</option>`;
      });
      select.innerHTML = options;
    }

    // 3. LOGIQUE DE SAUVEGARDE (√âtape 3B adapt√©e)
    function saveTask(event) {
      event.preventDefault();
      const form = event.target;

      if (!form.checkValidity()) {
        form.reportValidity();
        return;
      }

      // R√©cup√©ration des donn√©es
      const nouvelleTache = {
        idTache: Date.now().toString(), // Utilisation d'un timestamp pour un ID unique
        libelle: document.getElementById("libelle").value.trim(),
        description: document.getElementById("description").value.trim(),
        dateCreation: document.getElementById("dateCreation").value,
        dateFin: document.getElementById("dateFin").value || null,
        idPriorite: document.getElementById("priorite").value,
        idEtat: document.getElementById("etat").value,
        idContexte: document.getElementById("contexte").value
      };

      // Stockage LocalStorage
      let taches = JSON.parse(localStorage.getItem("taches")) || [];
      taches.push(nouvelleTache);
      localStorage.setItem("taches", JSON.stringify(taches));

      alert("T√¢che enregistr√©e avec succ√®s !");
      form.reset();
    }

    // INITIALISATION AU CHARGEMENT
    window.addEventListener("DOMContentLoaded", () => {
      // Remplir les menus d√©roulants
      fillSelect("priorite", dataApp.priorites);
      fillSelect("etat", dataApp.etats);
      fillSelect("contexte", dataApp.contextes);

      // Mettre la date du jour par d√©faut
      document.getElementById("dateCreation").valueAsDate = new Date();

      // √âcouter la soumission du formulaire
      document.getElementById("form-tache").addEventListener("submit", saveTask);
    });
  </script>
</body>
</html>
